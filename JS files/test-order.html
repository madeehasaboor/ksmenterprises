<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Test - AutoShine</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Order Process Test Page</h1>
        <p>Use this page to test the order process and identify any issues.</p>
        
        <div class="test-section">
            <h3>üì± WhatsApp Test</h3>
            <p>Test if WhatsApp integration is working correctly:</p>
            <button class="test-button" onclick="testWhatsApp()">Test WhatsApp Message</button>
            <button class="test-button" onclick="testWhatsAppDirect()">Test Direct WhatsApp Link</button>
            <div id="whatsapp-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìß Email API Test</h3>
            <p>Test if the email API endpoint is accessible:</p>
            <button class="test-button" onclick="testEmailAPI()">Test Email API</button>
            <div id="email-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üõí Full Order Test</h3>
            <p>Test the complete order process:</p>
            <button class="test-button" onclick="testFullOrder()">Test Complete Order</button>
            <div id="order-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìã Current Configuration</h3>
            <div class="info">
                <strong>WhatsApp Number:</strong> +923234890184<br>
                <strong>Email API:</strong> https://api.ksmenterprises.sbs/api/order<br>
                <strong>Target Email:</strong> saboormadiha@gmail.com
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîç Debug Information</h3>
            <button class="test-button" onclick="showDebugInfo()">Show Debug Info</button>
            <div id="debug-info"></div>
        </div>
    </div>

    <script>
        function testWhatsApp() {
            const testMessage = `üõí *TEST ORDER* - KSM-TEST-${Date.now()}%0A%0Aüë§ *Customer Details:*%0A‚Ä¢ Name: Test Customer%0A‚Ä¢ Phone: +923234890184%0A‚Ä¢ Address: Test Address%0A%0Aüì¶ *Order Details:*%0ATest Product x2 - Rs. 2,000%0A%0Aüí∞ *Total Amount: Rs. 2,000*%0A%0AüìÖ Date: ${new Date().toLocaleDateString()}%0A‚è∞ Time: ${new Date().toLocaleTimeString()}`;
            
            const whatsappLink = `https://wa.me/+923234890184?text=${testMessage}`;
            
            try {
                window.open(whatsappLink, '_blank');
                document.getElementById('whatsapp-result').innerHTML = '<div class="success">‚úÖ WhatsApp link opened successfully! Check if WhatsApp opened in a new tab.</div>';
            } catch (error) {
                document.getElementById('whatsapp-result').innerHTML = `<div class="error">‚ùå Error opening WhatsApp: ${error.message}</div>`;
            }
        }
        
        function testWhatsAppDirect() {
            const whatsappLink = `https://wa.me/+923234890184?text=Test message from KSM website`;
            document.getElementById('whatsapp-result').innerHTML = `<div class="info">üì± Direct WhatsApp link: <a href="${whatsappLink}" target="_blank">Click here to test</a></div>`;
        }
        
        function testEmailAPI() {
            const testData = {
                orderSummary: {
                    items: 'Test Product x2 - Rs. 2,000\n',
                    total: 2000,
                    orderNumber: 'KSM-TEST-' + Date.now()
                },
                customerInfo: {
                    name: 'Test Customer',
                    phone: '+923234890184',
                    address: 'Test Address',
                    email: 'test@example.com'
                }
            };
            
            fetch('https://api.ksmenterprises.sbs/api/order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testData)
            })
            .then(response => {
                console.log('API Response status:', response.status);
                return response.json();
            })
            .then(data => {
                document.getElementById('email-result').innerHTML = `<div class="success">‚úÖ Email API test successful! Response: ${JSON.stringify(data)}</div>`;
            })
            .catch(error => {
                document.getElementById('email-result').innerHTML = `<div class="error">‚ùå Email API test failed: ${error.message}</div>`;
            });
        }
        
        function testFullOrder() {
            // Simulate the full order process
            const orderSummary = {
                items: 'Test Product x2 - Rs. 2,000\n',
                total: 2000,
                orderNumber: 'KSM-TEST-' + Date.now()
            };
            
            const customerInfo = {
                name: 'Test Customer',
                phone: '+923234890184',
                address: 'Test Address',
                email: 'test@example.com'
            };
            
            // Test email first
            fetch('https://api.ksmenterprises.sbs/api/order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    orderSummary,
                    customerInfo
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    document.getElementById('order-result').innerHTML = '<div class="success">‚úÖ Full order test successful! Email sent successfully.</div>';
                } else {
                    throw new Error('Email sending failed: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Email sending failed:', error);
                
                // Fallback to WhatsApp
                const whatsappMessage = `üõí *TEST ORDER* - ${orderSummary.orderNumber}%0A%0Aüë§ *Customer Details:*%0A‚Ä¢ Name: ${customerInfo.name}%0A‚Ä¢ Phone: ${customerInfo.phone}%0A‚Ä¢ Address: ${customerInfo.address}%0A‚Ä¢ Email: ${customerInfo.email}%0A%0Aüì¶ *Order Details:*%0A${orderSummary.items}%0Aüí∞ *Total Amount: Rs. ${orderSummary.total.toLocaleString()}*%0A%0AüìÖ Date: ${new Date().toLocaleDateString()}%0A‚è∞ Time: ${new Date().toLocaleTimeString()}`;
                
                const whatsappLink = `https://wa.me/+923234890184?text=${whatsappMessage}`;
                
                try {
                    window.open(whatsappLink, '_blank');
                    document.getElementById('order-result').innerHTML = '<div class="success">‚úÖ Full order test completed! Email failed, but WhatsApp fallback worked. Check your WhatsApp for the test message.</div>';
                } catch (whatsappError) {
                    document.getElementById('order-result').innerHTML = `<div class="error">‚ùå Both email and WhatsApp failed. Error: ${whatsappError.message}</div>`;
                }
            });
        }
        
        function showDebugInfo() {
            const debugInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                currentTime: new Date().toISOString(),
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            document.getElementById('debug-info').innerHTML = `
                <div class="info">
                    <h4>Browser Information:</h4>
                    <pre>${JSON.stringify(debugInfo, null, 2)}</pre>
                </div>
            `;
        }
    </script>
</body>
</html> 